<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Release Delivery Portal</title>
<style>
body {background:#0b0b0b;color:white;font-family:Arial;margin:0;padding:20px;}
.container {max-width:800px;margin:auto;background:#151515;padding:30px;border-radius:12px;}
h1 {text-align:center;}
input, select, button {width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none;}
input {background:#222;color:white;}
button {background:#00ff99;color:black;font-weight:bold;cursor:pointer;}
.track {border:1px solid #333;padding:15px;margin-top:15px;border-radius:10px;}
.progressBar {height:8px;background:#333;margin-top:6px;border-radius:4px;}
.progressFill {height:100%;width:0;background:#00ff99;border-radius:4px;}
</style>
</head>
<body>

<div class="container">
<h1>Release Upload</h1>

<form id="releaseForm">

<label>Release Type</label>
<select id="releaseType" required>
  <option value="">Select</option>
  <option value="Single">Single</option>
  <option value="EP">EP</option>
  <option value="Album">Album</option>
</select>

<div id="tracksContainer"></div>

<label>Cover Artwork (3000x3000)</label>
<input type="file" id="coverArt" required>

<button type="button" id="addTrackBtn" onclick="addTrack()">+ Add Another Track</button>
<button type="submit" id="submitBtn">Upload Files</button>

</form>
</div>

<script>
const CLOUD_NAME = "djpeitfan";
const UPLOAD_PRESET = "label_upload";
let trackCount = 0;
let uploadedLinks = "";

function addTrack() {
  trackCount++;
  const div = document.createElement('div');
  div.className = "track";
  div.innerHTML = `
    <label>Track Title</label>
    <input type="text" required>

    <label>Version Name (optional)</label>
    <input type="text">

    <label>Audio File</label>
    <input type="file" class="audioFile" required>
  `;
  document.getElementById('tracksContainer').appendChild(div);
}

document.getElementById('releaseType').addEventListener('change', function() {
  const container = document.getElementById('tracksContainer');
  container.innerHTML = "";
  trackCount = 0;
  addTrack();
  document.getElementById("addTrackBtn").style.display =
    this.value === "Single" ? "none" : "block";
});

function uploadFile(file, container, isImage=false) {
  return new Promise(resolve => {
    const xhr = new XMLHttpRequest();
    const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`;

    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const bar = document.createElement("div");
    bar.className = "progressBar";
    const fill = document.createElement("div");
    fill.className = "progressFill";
    bar.appendChild(fill);
    container.appendChild(bar);

    xhr.upload.onprogress = e => {
      if (e.lengthComputable)
        fill.style.width = (e.loaded / e.total * 100) + "%";
    };

    xhr.onload = () => {
  const res = JSON.parse(xhr.responseText);

  // Use the secure_url directly (ALWAYS WORKS)
  const fileUrl = res.secure_url;

  if (isImage) {
    const img = document.createElement("img");
    img.src = fileUrl;
    img.style.width = "100%";
    img.style.marginTop = "10px";
    img.style.borderRadius = "8px";
    container.appendChild(img);
  }

  resolve(fileUrl);
};

    xhr.open("POST", url);
    xhr.send(formData);
  });
}

document.getElementById("releaseForm").addEventListener("submit", async e => {
  e.preventDefault();
  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  btn.innerText = "Uploading...";

  uploadedLinks = "";

  const audioInputs = document.querySelectorAll(".audioFile");
  for (let input of audioInputs) {
    const file = input.files[0];
    const url = await uploadFile(file, input.parentElement, false);
    uploadedLinks += url + "\n";
  }

  const cover = document.getElementById("coverArt").files[0];
  const coverUrl = await uploadFile(cover, document.getElementById("coverArt").parentElement, true);
  uploadedLinks += coverUrl;

  btn.innerText = "Send Release ðŸš€";
  btn.disabled = false;

  btn.onclick = async () => {
    btn.innerText = "Sending...";
    btn.disabled = true;

    const data = new FormData();
    data.append("file_links", uploadedLinks);
    data.append("release_type", document.getElementById("releaseType").value);

    await fetch("https://formspree.io/f/YOURCODE", { method:"POST", body:data });

    btn.innerText = "Submitted âœ…";
  };
});
</script>

</body>
</html>
